Connect-AzureAD
Connect-ExchangeOnline

$InitialDomain = Get-AzureADDomain | Where-Object {$PSItem.IsInitial -eq $True}
$Users = Get-AzureADUser -All $True | Where-Object {$PSItem.UserType -eq "Member"}
$DistGroups = Get-DistributionGroup

Foreach ($User in $Users) {
    $Prefix = ($User.UserPrincipalName -Split "@")[0]
    $NewUPN = $Prefix+"@"+$InitialDomain
    $EmailAddresses = Get-Mailbox -Identity $User.UserPrincipalName 
    Set-Mailbox -Identity $User.UserPrincipalName -EmailAddresses @{Remove=$EmailAddresses.EmailAddresses} -PrimarySMTPAddress $NewUPN -UserPrincipalName $NewUPN
}

Foreach ($Group in $DistGroups) {
    $GrpPrefix = ($Group.PrimarySMTPAddress -Split "@")[0]
    $GrpNewUPN = $GrpPrefix+"@"+$InitialDomain
    Set-DistributionGroup $Group.Name -PrimarySMTPAddress $GrpNewUPN
}
